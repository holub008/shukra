const {linearRegression} = require("../src/util");
const assert = require("assert");

const x = [1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0];
const y = [7.73191171106509, 5.04488480994564, 5.81697586087774, 4.70893451215457, 8.21001655984214, 4.84061038333957, 7.78917905113998, 7.22482849820253, 4.58066707929337, 8.67739790579615, 7.5417357677244, 5.24105462624865, 5.5739010062811, 4.63472858430913, 5.4899938293557, 5.24125652584057, 4.47690066002881, 7.54183073366307, 4.87560997244176, 5.30111124269289, 5.39508831716747, 3.82669596033656, 4.82448139991714, 7.51475302288344, 8.67729946012003, 3.56457676241453, 7.87607448581352, 6.97277178734127, 7.5845394012035, 4.73108221852609, 7.51784808315411, 7.01480868586639, 5.34836977582945, 7.41355473527019, 5.34608388248097, 8.31193532102122, 7.67345868933045, 8.41850911303576, 5.41037971924789, 7.6322839928986, 4.3257182561037, 4.73017513323062, 8.23626330433013, 4.88675093561019, 8.04459753052715, 5.91231656335844, 5.57096776796735, 4.75253679696174, 5.58614941670038, 5.46204536552779, 5.30001674096412, 8.63955994867201, 5.71193732742582, 7.36518447650921, 4.790705715612, 7.96991423136226, 7.74188335757876, 7.61773669930226, 5.03818382744032, 8.16812937699912, 7.18755877695215, 7.47933908529602, 7.63063973514139, 7.79582977704387, 6.83438133681033, 5.53331904415711, 6.52381908773644, 5.26707395469819, 4.58611193358249, 5.07526195971358, 8.05323033143114, 8.40344841079716, 8.25974068981759, 7.50401539790683, 4.9201366530612, 7.32052934338734, 4.34202525507319, 4.25943168111584, 5.35978190096627, 5.21032592017103, 4.64036538619132, 5.0181211800598, 5.344306983802, 8.14695639352892, 4.70768680856935, 5.09262139683509, 4.5558855985382, 5.2396326809005, 7.49985199456248, 4.32927503456145, 7.9603897131419, 7.79946057187374, 5.1400915304876, 7.69638539325199, 4.56111286355495, 7.80816434544011, 7.66550606291817, 7.88635426143101, 5.08733770541605, 4.90826864041379];
const y2 = [0.13291171106509, 0.144884809945643, 0.916975860877737, -0.19106548784543, 0.611016559842137, -0.0593896166604344, 0.19017905113998, -0.374171501797471, -0.319332920706628, 1.07839790579615, -0.0572642322756002, 0.341054626248651, 0.673901006281103, -0.265271415690865, 0.589993829355697, 0.341256525840569, -0.42309933997119, -0.0571692663369288, -0.024390027558244, 0.401111242692888, 0.495088317167469, -1.07330403966344, -0.0755186000828598, -0.0842469771165637, 1.07829946012003, -1.33542323758547, 0.277074485813517, -0.626228212658726, -0.0144605987965002, -0.168917781473913, -0.0811519168458943, -0.584191314133613, 0.448369775829451, -0.185445264729812, 0.446083882480975, 0.712935321021223, 0.074458689330448, 0.819509113035757, 0.510379719247889, 0.0332839928986004, -0.574281743896299, -0.169824866769377, 0.637263304330131, -0.0132490643898127, 0.44559753052715, 1.01231656335844, 0.67096776796735, -0.14746320303826, 0.686149416700381, 0.562045365527794, 0.400016740964119, 1.04055994867201, 0.811937327425825, -0.233815523490793, -0.109294284388003, 0.370914231362257, 0.142883357578755, 0.0187366993022589, 0.138183827440322, 0.569129376999117, -0.411441223047852, -0.119660914703984, 0.0316397351413906, 0.19682977704387, -0.764618663189666, 0.633319044157111, 1.62381908773644, 0.367073954698191, -0.313888066417509, 0.17526195971358, 0.454230331431138, 0.804448410797158, 0.660740689817589, -0.0949846020931707, 0.0201366530612036, -0.278470656612657, -0.557974744926806, -0.640568318884155, 0.459781900966266, 0.310325920171032, -0.259634613808676, 0.118121180059802, 0.444306983802005, 0.547956393528921, -0.192313191430647, 0.192621396835094, -0.344114401461803, 0.339632680900495, -0.0991480054375241, -0.570724965438546, 0.3613897131419, 0.200460571873744, 0.240091530487595, 0.0973853932519906, -0.338887136445046, 0.209164345440112, 0.0665060629181672, 0.28735426143101, 0.187337705416051, 0.00826864041379194];
describe('OLS', function () {
  it('should produce correct regression when strong signal', function () {
    /* validate with:
       n <- 100
       set.seed(1152)
       epsilon <- rnorm(n, mean=0, sd=sqrt(0.25))
       x <- sample(x=c(0, 1), size=n, replace=TRUE)
       y <- 5 + 2.7 * x + epsilon
       summary(lm(y~x+1))
     */
    const reg = linearRegression(y, x);
    assert.deepStrictEqual(reg, {
      intercept:  5.018961530458862,
      interceptP: 0,
      slope: 2.7597004151274684,
      slopeP: 0,
    });
  });

  it('should produce correct regression when weak signal', function () {
    /* validate with:
       y2 <- 0.1 + 0.001 * x + epsilon
       summary(lm(y2~x+1))
     */
    const reg = linearRegression(y2, x);
    assert.deepStrictEqual(reg, {
      intercept:  0.11896153045886437,
      interceptP: 0.07174931597504575,
      slope: 0.06070041512746545,
      slopeP: 0.5346307755868058,
    });
  });
});